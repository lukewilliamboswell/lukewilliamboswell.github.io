<!DOCTYPE html><html  lang="en"><head><title>Roc Examples</title><meta  charset="utf-8"></meta><meta  name="viewport" content="width=device-width"></meta><link  rel="icon" href="/favicon.svg"></link><link  rel="stylesheet" href="/styles.css"></link><script  type="text/javascript" src="/copy-btn.js" defer=""></script></head><body><div  class="top-header-extension"></div><header  class="top-header"><div  class="pkg-and-logo"><a  class="logo" href="/"><svg  viewBox="0 -6 51 58" fill="none" xmlns="http://www.w3.org/2000/svg" aria-labelledby="logo-link" role="img"><title  id="logo-link">Return to Roc packages</title><polygon  role="presentation" points="0,0 23.8834,3.21052 37.2438,19.0101 45.9665,16.6324 50.5,22 45,22 44.0315,26.3689 26.4673,39.3424 27.4527,45.2132 17.655,53 23.6751,22.7086"></polygon></svg></a><h1  class="pkg-full-name"><a  href="/index.html">Examples</a></h1></div><div  class="top-header-triangle"></div></header><p  class="feedback">we ðŸ’œ feedback: <a  href="https://github.com/roc-lang/examples">GitHub</a> | <a  href="https://roc.zulipchat.com/">Group Chat</a></p><main><h1>Task Usage</h1>
<p>This examples shows a few basic ways to use a <code>Task</code> with Roc's <a href="https://github.com/roc-lang/basic-cli">basic-cli platform</a>.
Read more about tasks in the <a href="https://www.roc-lang.org/tutorial#tasks">tutorial</a>.</p>
<h2>Output</h2>
<pre><samp>% roc run main.roc
Bonjour Louis!
Something error!
Ooooops, another failure!
</pre></samp>
<h2>Code</h2>
<pre><samp><span class="kw">app</span><span class="literal"> "task-usage"</span><span class="kw">
    packages</span><span class="delimeter"> {</span><span class="lowerident"> pf</span><span class="kw">:</span><span class="literal"> "https://github.com/roc-lang/basic-cli/releases/download/0.5.0/Cufzl36_SnJ4QbOoEmiJ5dIpUxBvdB3NEySvuH82Wio.tar.br"</span><span class="delimeter"> }</span><span class="kw">
    imports</span><span class="delimeter"> [</span><span class="lowerident">
        pf</span><span class="delimeter">.</span><span class="upperident">Stdout</span><span class="delimeter">,</span><span class="lowerident">
        pf</span><span class="delimeter">.</span><span class="upperident">Stderr</span><span class="delimeter">,</span><span class="lowerident">
        pf</span><span class="delimeter">.</span><span class="upperident">Task</span><span class="delimeter">,</span><span class="delimeter">
    ]</span><span class="kw">
    provides</span><span class="delimeter"> [</span><span class="lowerident">main</span><span class="delimeter">]</span><span class="kw"> to</span><span class="lowerident"> pf</span><span class="comment">

## A Task represents an effect; an interaction with state outside your Roc program, such as the terminal's standard output, or a file.</span><span class="comment">

## A simple Task that always succeeds.</span><span class="comment">
##</span><span class="comment">
## A Task has two type parameters: the type of value it produces when it finishes running,</span><span class="comment">
## and any errors that might happen when running it.</span><span class="comment">
##</span><span class="comment">
## The type `Task Str []` indicates that the success value of this task is</span><span class="comment">
## `Str` and it cannot fail, so the error type is empty. </span><span class="comment">
##</span><span class="comment">
# TODO re-enable type definition (issue #72)</span><span class="comment">
# getName : Task.Task Str []</span><span class="lowerident">
getName</span><span class="kw"> =</span><span class="upperident"> Task</span><span class="delimeter">.</span><span class="lowerident">ok</span><span class="literal"> "Louis"</span><span class="comment">

## This task uses the `getName` task and combines the returned `Str` with the</span><span class="comment">
## welcome message "Bonjour".</span><span class="comment">
##</span><span class="comment">
## We use `Task.map` to take the success value of the `getName` task, a `Str` and apply a function</span><span class="comment">
## to it with type `Str -&gt; Str`: `\name -&gt; "Bonjour \(name)!"`.</span><span class="comment">
##</span><span class="comment">
## The type of `Task.map` is `Task a err, (a -&gt; b) -&gt; Task b err`.</span><span class="comment">
## Filling this in for our case, this becomes: `Task Str [], (Str -&gt; Str) -&gt; Task Str []`</span><span class="comment">
## In this case the type variables `a` and `b` are both `Str`, the types may be different but</span><span class="comment">
## they don't need to be.</span><span class="comment">
##</span><span class="comment">
## Remember that `Task.map` is used to transform (= apply a function to) the success value of a Task.</span><span class="comment">
##</span><span class="comment">
## Next we use `Task.await` to print the new string to `Stdout`. This</span><span class="comment">
## function takes the `Str` and returns a new `Task`.</span><span class="comment">
##</span><span class="comment">
## `Stdout.line` has the type `Str -&gt; Task {} *`.</span><span class="comment">
## The type of `Task.await` is `Task a err, (a -&gt; Task b err) -&gt; Task b err`.</span><span class="comment">
## If we fill this in, we get: `Task Str [], (Str -&gt; Task {} *) -&gt; Task {} *`</span><span class="comment">
## `Task.await` is used to create a new task with the success value of a given task.</span><span class="comment">
# TODO re-enable type definition (issue #72)</span><span class="comment">
# printName : Task.Task {} []</span><span class="lowerident">
printName</span><span class="kw"> =</span><span class="lowerident">
    getName</span><span class="kw">
    |&gt;</span><span class="upperident"> Task</span><span class="delimeter">.</span><span class="lowerident">map</span><span class="delimeter"> (</span><span class="kw">\</span><span class="lowerident">name</span><span class="kw"> -&gt;</span><span class="literal"> "Bonjour \(name)!"</span><span class="delimeter">)</span><span class="kw">
    |&gt;</span><span class="upperident"> Task</span><span class="delimeter">.</span><span class="lowerident">await</span><span class="delimeter"> (</span><span class="kw">\</span><span class="lowerident">welcomeStr</span><span class="kw"> -&gt;</span><span class="upperident"> Stdout</span><span class="delimeter">.</span><span class="lowerident">line</span><span class="lowerident"> welcomeStr</span><span class="delimeter">)</span><span class="comment">

## This task is similar to `getName` but it always fails and returns the</span><span class="comment">
## error tag `Oops`.</span><span class="comment">
# TODO re-enable type definition (issue #72)</span><span class="comment">
# alwaysFail : Task.Task {} [Oops]</span><span class="lowerident">
alwaysFail</span><span class="kw"> =</span><span class="upperident"> Task</span><span class="delimeter">.</span><span class="lowerident">err</span><span class="upperident"> Oops</span><span class="comment">

## Here we use `Task.onErr` to create a new task if the previous one failed.</span><span class="comment">
## In this case we are printing an error message to `Stdout`.</span><span class="comment">
##</span><span class="comment">
## The type of `Task.onErr` is `Task ok a, (a -&gt; Task ok b) -&gt; Task ok b`.</span><span class="comment">
## If we fill this in, we get `Task {} [Oops], (Oops -&gt; Task {} *) -&gt; Task {} *`</span><span class="comment">
##</span><span class="comment">
## You can see the similarity with `Task.await`.</span><span class="comment">
## With `Task.await` we create a new Task with the success value,</span><span class="comment">
## and with `Task.onErr` we create a new Task with the failure value.</span><span class="comment">
##</span><span class="comment">
# TODO re-enable type definition (issue #72)</span><span class="comment">
# printErrorMessage : Task.Task {} []</span><span class="lowerident">
printErrorMessage</span><span class="kw"> =</span><span class="lowerident">
    alwaysFail</span><span class="kw">
    |&gt;</span><span class="upperident"> Task</span><span class="delimeter">.</span><span class="lowerident">onErr</span><span class="kw"> \</span><span class="lowerident">err</span><span class="kw"> -&gt;</span><span class="kw">
        when</span><span class="lowerident"> err</span><span class="kw"> is</span><span class="upperident">
            Oops</span><span class="kw"> -&gt;</span><span class="upperident"> Stderr</span><span class="delimeter">.</span><span class="lowerident">line</span><span class="literal"> "Something error!"</span><span class="comment">

## This task will either fail or succeed depending on the Boolean value provided.</span><span class="comment">
## If we review the type annotation, we can see that if this task succeeds it will </span><span class="comment">
## return a tag union with a single tag, `Success`. If it fails it may return</span><span class="comment">
## any one of three different tags. </span><span class="comment">
##</span><span class="comment">
## Note we are only using the `AnotherFail` tag here.   </span><span class="lowerident">
canFail</span><span class="kw"> :</span><span class="upperident"> Bool</span><span class="kw"> -&gt;</span><span class="upperident"> Task</span><span class="delimeter">.</span><span class="upperident">Task</span><span class="delimeter"> [</span><span class="upperident">Success</span><span class="delimeter">]</span><span class="delimeter"> [</span><span class="upperident">Failure</span><span class="delimeter">,</span><span class="upperident"> AnotherFail</span><span class="delimeter">,</span><span class="upperident"> YetAnotherFail</span><span class="delimeter">]</span><span class="lowerident">
canFail</span><span class="kw"> =</span><span class="kw"> \</span><span class="lowerident">shouldFail</span><span class="kw"> -&gt;</span><span class="kw">
    if</span><span class="lowerident"> shouldFail</span><span class="kw"> then</span><span class="upperident">
        Task</span><span class="delimeter">.</span><span class="lowerident">err</span><span class="upperident"> AnotherFail</span><span class="kw">
    else</span><span class="upperident">
        Task</span><span class="delimeter">.</span><span class="lowerident">ok</span><span class="upperident"> Success</span><span class="lowerident">

main</span><span class="kw"> =</span><span class="comment">
    # Let's run our tasks in sequence, we can use `Task.await` and backpassing</span><span class="comment">
    # syntax here because we know these tasks cannot fail, or if they do we</span><span class="comment">
    # handle any errors.</span><span class="delimeter">
    {</span><span class="delimeter">}</span><span class="kw"> &lt;-</span><span class="lowerident"> printName</span><span class="kw"> |&gt;</span><span class="upperident"> Task</span><span class="delimeter">.</span><span class="lowerident">await</span><span class="delimeter">
    {</span><span class="delimeter">}</span><span class="kw"> &lt;-</span><span class="lowerident"> printErrorMessage</span><span class="kw"> |&gt;</span><span class="upperident"> Task</span><span class="delimeter">.</span><span class="lowerident">await</span><span class="comment">

    # Here we know that the `canFail` task may fail, and so we can use</span><span class="comment">
    # `Task.attempt` to convert the task to a `Result` and use then pattern </span><span class="comment">
    # matching to handle the succes and each of the possible failure cases.</span><span class="lowerident">
    result</span><span class="kw"> &lt;-</span><span class="lowerident"> canFail</span><span class="upperident"> Bool</span><span class="delimeter">.</span><span class="lowerident">true</span><span class="kw"> |&gt;</span><span class="upperident"> Task</span><span class="delimeter">.</span><span class="lowerident">attempt</span><span class="kw">
    when</span><span class="lowerident"> result</span><span class="kw"> is</span><span class="upperident">
        Ok</span><span class="upperident"> Success</span><span class="kw"> -&gt;</span><span class="upperident">
            Stdout</span><span class="delimeter">.</span><span class="lowerident">line</span><span class="literal"> "Success!"</span><span class="upperident">

        Err</span><span class="upperident"> Failure</span><span class="kw"> -&gt;</span><span class="delimeter">
            {</span><span class="delimeter">}</span><span class="kw"> &lt;-</span><span class="upperident"> Stdout</span><span class="delimeter">.</span><span class="lowerident">line</span><span class="literal"> "Oops, failed!"</span><span class="kw"> |&gt;</span><span class="upperident"> Task</span><span class="delimeter">.</span><span class="lowerident">await</span><span class="upperident">

            Task</span><span class="delimeter">.</span><span class="lowerident">err</span><span class="literal"> 1</span><span class="comment"> # 1 is an exit code to indicate failure</span><span class="upperident">

        Err</span><span class="upperident"> AnotherFail</span><span class="kw"> -&gt;</span><span class="delimeter">
            {</span><span class="delimeter">}</span><span class="kw"> &lt;-</span><span class="upperident"> Stdout</span><span class="delimeter">.</span><span class="lowerident">line</span><span class="literal"> "Ooooops, another failure!"</span><span class="kw"> |&gt;</span><span class="upperident"> Task</span><span class="delimeter">.</span><span class="lowerident">await</span><span class="upperident">

            Task</span><span class="delimeter">.</span><span class="lowerident">err</span><span class="literal"> 1</span><span class="upperident">

        Err</span><span class="upperident"> YetAnotherFail</span><span class="kw"> -&gt;</span><span class="delimeter">
            {</span><span class="delimeter">}</span><span class="kw"> &lt;-</span><span class="upperident"> Stdout</span><span class="delimeter">.</span><span class="lowerident">line</span><span class="literal"> "Really big oooooops, yet again!"</span><span class="kw"> |&gt;</span><span class="upperident"> Task</span><span class="delimeter">.</span><span class="lowerident">await</span><span class="upperident">

            Task</span><span class="delimeter">.</span><span class="lowerident">err</span><span class="literal"> 1</span></samp></pre></main><footer><p>Made by people who like to make nice things Â© 2023</p></footer></body></html>